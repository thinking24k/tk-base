<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bqsolo.main.dao.UserDao">

	<!-- 注意：1. BaseResultMap 与底层架构有关,除数据库变更.严禁人为修改. -->
	<resultMap id="BaseResultMap"  type="com.bqsolo.main.entity.UserEntity">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="nickname" property="nickname" jdbcType="VARCHAR" />
		<result column="email" property="email" jdbcType="VARCHAR" />
		<result column="mobile" property="mobile" jdbcType="VARCHAR" />
		<result column="password" property="password" jdbcType="VARCHAR" />
		<result column="img" property="img" jdbcType="VARCHAR" />
		<result column="priority" property="priority" jdbcType="DOUBLE" />
		<result column="sex" property="sex" jdbcType="INTEGER" />
		<result column="logintime" property="logintime" jdbcType="INTEGER" />
		<result column="cuid" property="cuid" jdbcType="INTEGER" />
		<result column="cdate" property="cdate" jdbcType="TIMESTAMP" />
		<result column="upuid" property="upuid" jdbcType="INTEGER" />
		<result column="update" property="update" jdbcType="TIMESTAMP" />
		<result column="isvoid" property="isvoid" jdbcType="INTEGER" />
	</resultMap>

	<sql id="allColumn">
		id,nickname,email,mobile,password,img,priority,sex,logintime,cuid,cdate,upuid,update,isvoid
	</sql>

	<insert id="doAdd"  parameterType="com.bqsolo.main.entity.UserEntity" >
    	 insert into user ( 
 <if test="null != nickname"  >nickname,</if>
<if test="null != email"  >email,</if>
<if test="null != mobile"  >mobile,</if>
<if test="null != password"  >password,</if>
<if test="null != img"  >img,</if>
<if test="null != priority"  >priority,</if>
<if test="null != sex"  >sex,</if>
<if test="null != logintime"  >logintime,</if>
<if test="null != cuid"  >cuid,</if>
<if test="null != cdate"  >cdate,</if>
<if test="null != upuid"  >upuid,</if>
<if test="null != update"  >update,</if>
 
 isvoid) values ( 
<if test="null != nickname"  >#{nickname},</if>
<if test="null != email"  >#{email},</if>
<if test="null != mobile"  >#{mobile},</if>
<if test="null != password"  >#{password},</if>
<if test="null != img"  >#{img},</if>
<if test="null != priority"  >#{priority},</if>
<if test="null != sex"  >#{sex},</if>
<if test="null != logintime"  >#{logintime},</if>
<if test="null != cuid"  >#{cuid},</if>
<if test="null != cdate"  >#{cdate},</if>
<if test="null != upuid"  >#{upuid},</if>
<if test="null != update"  >#{update},</if>
 
 #{isvoid})
  	</insert>
  	
	<insert id="doAddBatch"  parameterType="java.util.List" >
    	insert into user (
					<if test="null != nickname"  >
						 nickname,
					</if>
					<if test="null != email"  >
						 email,
					</if>
					<if test="null != mobile"  >
						 mobile,
					</if>
					<if test="null != password"  >
						 password,
					</if>
					<if test="null != img"  >
						 img,
					</if>
					<if test="null != priority"  >
						 priority,
					</if>
					<if test="null != sex"  >
						 sex,
					</if>
					<if test="null != logintime"  >
						 logintime,
					</if>
					<if test="null != cuid"  >
						 cuid,
					</if>
					<if test="null != cdate"  >
						 cdate,
					</if>
					<if test="null != upuid"  >
						 upuid,
					</if>
					<if test="null != update"  >
						 update,
					</if>
					<if test="null != isvoid"  >
						 isvoid,
					</if>
		 ) values
		 <foreach collection="list" item="item" index="index" open="(" close=")" separator=",">
						<if test="null != nickname"  >
						 	#{nickname},
						</if>
						<if test="null != email"  >
						 	#{email},
						</if>
						<if test="null != mobile"  >
						 	#{mobile},
						</if>
						<if test="null != password"  >
						 	#{password},
						</if>
						<if test="null != img"  >
						 	#{img},
						</if>
						<if test="null != priority"  >
						 	#{priority},
						</if>
						<if test="null != sex"  >
						 	#{sex},
						</if>
						<if test="null != logintime"  >
						 	#{logintime},
						</if>
						<if test="null != cuid"  >
						 	#{cuid},
						</if>
						<if test="null != cdate"  >
						 	#{cdate},
						</if>
						<if test="null != upuid"  >
						 	#{upuid},
						</if>
						<if test="null != update"  >
						 	#{update},
						</if>
						<if test="null != isvoid"  >
						 	#{isvoid},
						</if>
		</foreach>
  	</insert>
  	
	<update id="doUpdate"   parameterType="com.bqsolo.main.entity.UserEntity" >
	    update 
	    	user
	    <set>
					<if test="null != nickname"  >
						 nickname = #{nickname,jdbcType=VARCHAR},
					</if>
					<if test="null != email"  >
						 email = #{email,jdbcType=VARCHAR},
					</if>
					<if test="null != mobile"  >
						 mobile = #{mobile,jdbcType=VARCHAR},
					</if>
					<if test="null != password"  >
						 password = #{password,jdbcType=VARCHAR},
					</if>
					<if test="null != img"  >
						 img = #{img,jdbcType=VARCHAR},
					</if>
					<if test="null != priority"  >
						 priority = #{priority,jdbcType=DOUBLE},
					</if>
					<if test="null != sex"  >
						 sex = #{sex,jdbcType=INTEGER},
					</if>
					<if test="null != logintime"  >
						 logintime = #{logintime,jdbcType=INTEGER},
					</if>
					<if test="null != cuid"  >
						 cuid = #{cuid,jdbcType=INTEGER},
					</if>
					<if test="null != cdate"  >
						 cdate = #{cdate,jdbcType=TIMESTAMP},
					</if>
					<if test="null != upuid"  >
						 upuid = #{upuid,jdbcType=INTEGER},
					</if>
					<if test="null != update"  >
						 update = #{update,jdbcType=TIMESTAMP},
					</if>
					<if test="null != isvoid"  >
						 isvoid = #{isvoid,jdbcType=INTEGER},
					</if>
	    </set>
	     <where>
						 id =#{id,jdbcType=INTEGER}
		</where>
	 </update>
	 
     	
  	<delete id="doDelete"  >
  		delete  from 
  			user
	  	<where> 
	  		id 
	  	=
			${pk}
		</where>
    </delete>
    
  	<delete id="doDeletes"  parameterType="java.util.List" >
  		delete  from 
  			user
	  	<where> 
	  		id 
	  	in 
			<foreach collection="pks" item="item" index="index" open="(" close=")" separator=",">
				${item}
			</foreach>
		</where>
    </delete>
    
    <update id="doRemove" >
    	update 
    		user
    	set isvoid = 1
	    <if test="entity.changeuserid != null" >
	      ,upuid = #{e.upuid,jdbcType=BIGINT}
	    </if>
	    <choose>
	      <when test="entity.changedate != null">
	        ,update = #{e.update,jdbcType=TIMESTAMP}
	      </when>
	      <otherwise>
	        ,update = NOW()
	      </otherwise>
	    </choose>
	     <where>
		     id = ${pk}
		</where>
  	</update>
  		
   <select id="getById" resultMap="BaseResultMap" >
	    select
      		<include refid="allColumn" />
      	from 
      		user
	    <where>
		    id = ${pk}
		</where>
  </select>
  
  	<select id="getByIds" resultMap="BaseResultMap" parameterType="java.util.List">
	  	select
      		<include refid="allColumn" />
      	from 
      		user
	  	<where> 
	  		id 
	  	in 
			<foreach collection="pks" item="item" index="index" open="(" close=")" separator=",">
				${item}
			</foreach>
		</where>
  	</select>
  
   <select id="getCount" resultType="java.lang.Long">
      select count(*) from user
      <if test="_parameter != null">
          <include refid="sqlCriCondition"/>
      </if>
  </select>  
  
  <select id="queryForList" resultMap="BaseResultMap">
      select
      <include refid="allColumn" />
      from user
      <if test="_parameter != null">
        <include refid="sqlCriCondition"/>
        <include refid="sortSql"/>
        <include refid="com.bqsolo.framework.dao.CommonMapper.pagingLimit"/>
      </if>
  </select>
  
  <select id="queryForPageList" resultMap="BaseResultMap">
      select
      <include refid="allColumn" />
      from user
      <if test="_parameter != null">
        <include refid="sqlCriCondition"/>
        <include refid="sortSql"/>
        <include refid="com.bqsolo.framework.dao.CommonMapper.pagingLimit"/>
      </if>
      limit #{page.pageBean.dateNo},#{page.pageBean.pageSize}
  </select>
  
 

  <!--条件查询时 日期默认= 字符默认like 其他默认= 需要进行其他逻辑处理请自行更改-->
  <sql id="sqlCriCondition">
  	<where>
  	 <include refid="com.bqsolo.framework.dao.CommonMapper.isVoidCondition"/>
		<if test="null != id">
			AND id = #{id,jdbcType=INTEGER}
		</if>	
		<if test="null != nickname and nickname != ''">
			AND nickname LIKE CONCAT('%', #{nickname,jdbcType=VARCHAR}, '%')
		</if>
		<if test="null != email and email != ''">
			AND email LIKE CONCAT('%', #{email,jdbcType=VARCHAR}, '%')
		</if>
		<if test="null != mobile and mobile != ''">
			AND mobile LIKE CONCAT('%', #{mobile,jdbcType=VARCHAR}, '%')
		</if>
		<if test="null != password and password != ''">
			AND password LIKE CONCAT('%', #{password,jdbcType=VARCHAR}, '%')
		</if>
		<if test="null != img and img != ''">
			AND img LIKE CONCAT('%', #{img,jdbcType=VARCHAR}, '%')
		</if>
		<if test="null != priority">
			AND priority = #{priority,jdbcType=DOUBLE}
		</if>	
		<if test="null != sex">
			AND sex = #{sex,jdbcType=INTEGER}
		</if>	
		<if test="null != logintime">
			AND logintime = #{logintime,jdbcType=INTEGER}
		</if>	
		<if test="null != cuid">
			AND cuid = #{cuid,jdbcType=INTEGER}
		</if>	
		<if test="null != cdate and cdate != ''">
			AND cdate = #{cdate,jdbcType=TIMESTAMP}
		</if>
		<if test="null != upuid">
			AND upuid = #{upuid,jdbcType=INTEGER}
		</if>	
		<if test="null != update and update != ''">
			AND update = #{update,jdbcType=TIMESTAMP}
		</if>
		<if test="null != isvoid">
			AND isvoid = #{isvoid,jdbcType=INTEGER}
		</if>	
  	</where>
  </sql>  
  
    <sql id="sortSql">
        order by
        <choose>
            <when test="sortItemMap == null">
                creationdate desc
            </when>
            <otherwise>
                <foreach collection="sortItemMap.keySet()" item="field" separator=",">
                    <choose>
						<when test="field == 'nickname'">
			                 nickname ${sortItemMap.nickname}
			            </when>
						<when test="field == 'email'">
			                 email ${sortItemMap.email}
			            </when>
						<when test="field == 'mobile'">
			                 mobile ${sortItemMap.mobile}
			            </when>
						<when test="field == 'password'">
			                 password ${sortItemMap.password}
			            </when>
						<when test="field == 'img'">
			                 img ${sortItemMap.img}
			            </when>
						<when test="field == 'priority'">
			                 priority ${sortItemMap.priority}
			            </when>
						<when test="field == 'sex'">
			                 sex ${sortItemMap.sex}
			            </when>
						<when test="field == 'logintime'">
			                 logintime ${sortItemMap.logintime}
			            </when>
						<when test="field == 'cuid'">
			                 cuid ${sortItemMap.cuid}
			            </when>
						<when test="field == 'cdate'">
			                 cdate ${sortItemMap.cdate}
			            </when>
						<when test="field == 'upuid'">
			                 upuid ${sortItemMap.upuid}
			            </when>
						<when test="field == 'update'">
			                 update ${sortItemMap.update}
			            </when>
						<when test="field == 'isvoid'">
			                 isvoid ${sortItemMap.isvoid}
			            </when>
						<otherwise>
							id asc
						</otherwise>
					</choose>
                </foreach>
            </otherwise>
        </choose>
    </sql>  


</mapper>